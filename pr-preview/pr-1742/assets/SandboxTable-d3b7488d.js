import"./KMethodBadge.vue_vue_type_style_index_0_scoped_7163314d_lang-f7cf77a3.js";import{f as Ge,e as Ve,K as xe,c as ce}from"./KButton-a4a69627.js";import{a as Ue,_ as Qe,b as de}from"./KPagination-4191a1f8.js";import{v as We,u as be}from"./useUtilities-efbdde2e.js";import{d as pe,E as Je,k as Xe,c as S,l as n,i as L,m as Ze,o as r,a as b,v as H,q as R,A as F,s as M,p as E,F as W,b as J,u as X,G as fe,H as ve,e as ge,w as k,f as A,t as C,_ as De}from"./index-d7edae6d.js";import"./KInput-62a47042.js";const Ye=["default","offset"],_e=["ascending","descending",""],et=["true","loading"],tt={class:"k-table-container"},at={key:0,class:"k-table-toolbar","data-testid":"k-table-toolbar"},lt={key:2,class:"k-table-error-state","data-testid":"k-table-error-state"},st={key:3,class:"k-table-empty-state","data-testid":"k-table-empty-state"},ot=["data-tableid"],nt=["aria-sort","onClick"],rt={class:"k-table-headers-container"},it=["role","tabindex"],{clientSideSorter:ut}=be(),ye=(t,p,l,m)=>ut(t,p,l,m),ct=pe({__name:"KTable",props:{options:{type:Object,default:()=>null,required:!1},enableClientSort:{type:Boolean,default:!1},hasHover:{type:Boolean,default:!0},sortOrder:{type:String,default:"",validator:t=>_e.includes(t)},sortKey:{type:String,default:""},sortHandlerFn:{type:Function,default:()=>({})},rowAttrs:{type:Function,default:()=>({})},hasSideBorder:{type:Boolean,default:!1},cellAttrs:{type:Function,default:()=>({})},isLoading:{type:Boolean,default:!1},emptyStateTitle:{type:String,default:"No Data"},emptyStateMessage:{type:String,default:"There is no data to display."},emptyStateActionRoute:{type:[Object,String],default:""},emptyStateActionMessage:{type:String,default:""},emptyStateActionButtonIcon:{type:String,default:""},emptyStateIcon:{type:String,default:""},emptyStateIconColor:{type:String,default:""},emptyStateIconSize:{type:String,default:"50"},hasError:{type:Boolean,default:!1},errorStateTitle:{type:String,default:"An error occurred"},errorStateMessage:{type:String,default:"Data cannot be displayed due to an error."},errorStateActionRoute:{type:[Object,String],default:""},errorStateActionMessage:{type:String,default:""},errorStateIcon:{type:String,default:""},errorStateIconColor:{type:String,default:""},errorStateIconSize:{type:String,default:"50"},fetcher:{type:Function,default:void 0,required:!0},fetcherCacheKey:{type:String,default:""},cacheIdentifier:{type:String,default:""},searchInput:{type:String,default:""},headers:{type:Array,default:()=>[]},initialFetcherParams:{type:Object,default:null},paginationNeighbors:{type:Number,default:1},paginationPageSizes:{type:Array,default:()=>[15,30,50,75,100],validator:t=>!!t.length&&t.every(p=>typeof p=="number")},paginationTotalItems:{type:Number,default:null},disablePaginationPageJump:{type:Boolean,default:!1},disableSorting:{type:Boolean,default:!1},disablePagination:{type:Boolean,default:!1},paginationType:{type:String,default:"default",validator:t=>Ye.includes(t)},hidePaginationWhenOptional:{type:Boolean,default:!1},testMode:{type:String,default:void 0,validator:t=>et.includes(t)}},emits:["cell-click","row-click","ktable-error-cta-clicked","ktable-empty-state-cta-clicked","update:table-preferences","sort","state"],setup(t,{emit:p}){const l=t,{useDebounce:m,useRequest:G,useSwrvState:he}=be(),Z=Je(),Se=Xe(),B=S(()=>l.testMode?"test-table-id-1234":We()),I={pageSize:15,page:1,query:"",sortColumnKey:"",sortColumnOrder:"desc",offset:null},g=n([]),j=n([]),q=n(0),T=n(!1),u=n(1),P=n(15),D=n(""),d=n(""),c=n("desc"),h=n(null),z=n([]),w=n(!1),V=n(!1),x=n(!1),me=S(()=>!!Se.toolbar),ke=e=>`column-${e}`,Y=e=>e,_=(e,s)=>(a,o)=>{const f=/^on[^a-z]/,i={};for(const v in s)f.test(v)&&s[v]&&(i[v]=s[v]);return Object.keys(i).reduce((v,K)=>{if(K.indexOf(e)===0){const $=K.split(e);v[$[1]]=y=>i[K](y,a,o)}return v},{})},ee=S(()=>(e,s)=>{const a=_("onRow:",Z)(s,"row"),o=_("onCell:",Z)(e,"cell"),f=["a","button","input","select"];return a.click&&(w.value=!0),{...a,...o,click(i){const v=i.target.className;let K=f.includes(i.target.tagName.toLowerCase()),$=!1;typeof v=="string"||Array.isArray(v)?$=v.includes("k-popover"):typeof v=="object"&&($=Object.keys(v).includes("k-popover")),i.target.closest(".k-popover-content")!==null&&($=!0);for(let y=0;y<f.length;y++)if(i.target.closest(f[y])!==null){K=!0;break}if((!K||i.target.hasAttribute("disabled"))&&!$&&(a.click||o.click))if(o.click){p("cell-click",{data:e});const y=o.click(i,e,"cell");typeof y=="function"&&y(i,e)}else{p("row-click",{data:s});const y=a.click(i,s,"row");typeof y=="function"&&y(i,s)}}}}),te=n(!0),Ce=async()=>{var a,o;const e=l.searchInput,s=await l.fetcher({pageSize:P.value,page:u.value,query:e||D.value,sortColumnKey:d.value,sortColumnOrder:c.value,offset:h.value});return g.value=s.data,q.value=l.paginationTotalItems||s.total||((a=s.data)==null?void 0:a.length),l.fetcher?l.enableClientSort&&d.value&&c.value&&ye(d.value,"",c.value,g.value):l.options&&l.options.data&&l.options.data.length&&(g.value=l.options.data,q.value=l.options.data.length),l.paginationType==="offset"&&((o=s.pagination)!=null&&o.offset?(h.value=s.pagination.offset,z.value[u.value]||z.value.push(s.pagination.offset)):(h.value=null,x.value||(u.value=1))),x.value=!1,te.value=!1,s},Ae=()=>{const e={...I,...l.initialFetcherParams};u.value=e.page??I.page,P.value=e.pageSize??I.pageSize,D.value=e.query??I.query,d.value=e.sortColumnKey??I.sortColumnKey,c.value=e.sortColumnOrder??I.sortColumnOrder,l.paginationType==="offset"&&(h.value=e.offset,z.value.push(e.offset)),l.headers&&l.headers.length?j.value=l.headers:l.options&&l.options.headers&&l.options.headers.length&&(j.value=l.options.headers),V.value=!0},U=S(()=>z.value[u.value-1]),Ie=S(()=>{if(!l.fetcher||!V.value)return"";let e=B.value;return l.cacheIdentifier&&(e=l.cacheIdentifier),l.fetcherCacheKey&&(e+=`-${l.fetcherCacheKey}`),`k-table_${e}`}),ae=n(""),{debouncedFn:Te,generateDebouncedFn:Pe}=m(e=>{ae.value=e},350),ze=Pe(0),{data:le,error:se,revalidate:Oe,isValidating:Ke}=G(()=>Ie.value,()=>Ce(),{revalidateOnFocus:!1,revalidateDebounce:0}),{state:Q,hasData:$e,swrvState:oe}=he(le,se,Ke),O=n(!0),ne=S(()=>({hasData:$e.value,state:Q.value})),Me=S(()=>O.value?"loading":se.value?"error":"success"),{debouncedFn:re,generateDebouncedFn:Fe}=m(Oe,500),Be=Fe(0),Ne=e=>{const{key:s,useSortHandlerFn:a}=e,o=d.value+"";u.value=1,d.value&&s===d.value?c.value==="asc"?c.value="desc":c.value="asc":(d.value=s,c.value="asc"),l.options&&l.options.data||l.enableClientSort?a&&l.sortHandlerFn?l.sortHandlerFn({key:s,prevKey:o,sortColumnOrder:c.value,data:g.value}):ye(s,o,c.value,g.value):l.paginationType!=="offset"&&re(),ie()},Le=({page:e})=>{u.value=e},He=({pageSize:e})=>{z.value=[null],h.value=null,P.value=e,u.value=1,ie()},Re=e=>{e&&e.target&&e.target.scrollTop&&(e.target.scrollTop>1?T.value=!0:e.target.scrollTop&&(T.value=!T.value))},Ee=S(()=>({pageSize:P.value,sortColumnKey:d.value,sortColumnOrder:c.value})),ie=()=>{p("update:table-preferences",Ee.value)},je=()=>{u.value++,x.value=!0},qe=()=>{u.value--,h.value=U.value},we=S(()=>!!(l.fetcher&&!l.disablePagination&&!(l.paginationType!=="offset"&&l.hidePaginationWhenOptional&&q.value<=l.paginationPageSizes[0])&&!(l.paginationType==="offset"&&l.hidePaginationWhenOptional&&!U.value&&!h.value&&g.value.length<l.paginationPageSizes[0]))),ue=e=>e.toLowerCase().replace(/[^[a-z0-9]/gi,"-");L(le,e=>{e!=null&&e.length&&!g.value.length&&(g.value=e)},{deep:!0,immediate:!0}),L(Q,()=>{switch(Q.value){case oe.PENDING:O.value=!0;break;case oe.VALIDATING_HAS_DATA:O.value=N.value;break;default:O.value=!1;break}},{immediate:!0}),L([ne,Me],e=>{var s;p("state",{state:e==null?void 0:e[1],hasData:(s=e==null?void 0:e[0])==null?void 0:s.hasData})}),L(()=>l.searchInput,e=>{u.value!==1&&(u.value=1),e===""?ze(e):Te(e)},{immediate:!0});const N=n(!1);return L([ae,u,P],async(e,s)=>{const a=s==null?void 0:s[0],o=e[0],f=e[1];o!==a&&f!==1&&(u.value=1,z.value=[null],h.value=null),V.value&&!te.value&&(N.value=!0,o!==""&&o!==a?await re():await Be(),N.value=!1)},{deep:!0,immediate:!0}),Ze(()=>{Ae()}),(e,s)=>(r(),b("div",tt,[me.value?(r(),b("div",at,[H(e.$slots,"toolbar",{state:ne.value},void 0,!0)])):R("",!0),(!t.testMode||t.testMode==="loading")&&(O.value||t.isLoading||N.value)&&!t.hasError?(r(),F(Qe,{key:1,"data-testid":"k-table-skeleton",type:"table"})):t.hasError?(r(),b("div",lt,[H(e.$slots,"error-state",{},()=>[ge(de,{"cta-is-hidden":!t.errorStateActionMessage||!t.errorStateActionRoute,icon:t.errorStateIcon||"","icon-color":t.errorStateIconColor,"icon-size":t.errorStateIconSize,"is-error":""},{title:k(()=>[A(C(t.errorStateTitle),1)]),message:k(()=>[A(C(t.errorStateMessage),1)]),cta:k(()=>[t.errorStateActionMessage?(r(),F(ce,{key:0,appearance:"primary","data-testid":ue(t.errorStateActionMessage),to:t.errorStateActionRoute?t.errorStateActionRoute:void 0,onClick:s[0]||(s[0]=a=>e.$emit("ktable-error-cta-clicked"))},{default:k(()=>[A(C(t.errorStateActionMessage),1)]),_:1},8,["data-testid","to"])):R("",!0)]),_:1},8,["cta-is-hidden","icon","icon-color","icon-size"])],!0)])):!t.hasError&&!O.value&&!t.isLoading&&!N.value&&g.value&&!g.value.length?(r(),b("div",st,[H(e.$slots,"empty-state",{},()=>[ge(de,{"cta-is-hidden":!t.emptyStateActionMessage||!t.emptyStateActionRoute,icon:t.emptyStateIcon||"","icon-color":t.emptyStateIconColor,"icon-size":t.emptyStateIconSize},{title:k(()=>[A(C(t.emptyStateTitle),1)]),message:k(()=>[A(C(t.emptyStateMessage),1)]),cta:k(()=>[t.emptyStateActionMessage?(r(),F(ce,{key:0,appearance:t.searchInput?"btn-link":"primary","data-testid":ue(t.emptyStateActionMessage),icon:t.emptyStateActionButtonIcon,to:t.emptyStateActionRoute?t.emptyStateActionRoute:void 0,onClick:s[1]||(s[1]=a=>e.$emit("ktable-empty-state-cta-clicked"))},{default:k(()=>[A(C(t.emptyStateActionMessage),1)]),_:1},8,["appearance","data-testid","icon","to"])):R("",!0)]),_:1},8,["cta-is-hidden","icon","icon-color","icon-size"])],!0)])):(r(),b("section",{key:4,class:"k-table-wrapper",onScrollPassive:Re},[M("table",{class:E(["k-table",{"has-hover":t.hasHover,"is-clickable":w.value,"side-border":t.hasSideBorder}]),"data-tableid":B.value},[M("thead",{class:E({"is-scrolled":T.value})},[M("tr",{class:E({"is-scrolled":T.value})},[(r(!0),b(W,null,J(j.value,(a,o)=>(r(),b("th",{key:`k-table-${B.value}-headers-${o}`,"aria-sort":!t.disableSorting&&a.key===d.value?c.value==="asc"?"ascending":"descending":void 0,class:E(["k-table-headers",{sortable:!t.disableSorting&&!a.hideLabel&&a.sortable,"active-sort":!t.disableSorting&&!a.hideLabel&&a.sortable&&a.key===d.value,[c.value]:!t.disableSorting&&a.key===d.value&&!a.hideLabel,"is-scrolled":T.value}]),onClick:()=>{!t.disableSorting&&a.sortable&&(e.$emit("sort",{prevKey:d.value,sortColumnKey:a.key,sortColumnOrder:c.value==="asc"?"desc":"asc"}),Ne(a))}},[M("span",rt,[H(e.$slots,ke(a.key),{column:Y(a)},()=>[M("span",{class:E({"sr-only":a.hideLabel})},C(a.label?a.label:a.key),3)],!0),!t.disableSorting&&!a.hideLabel&&a.sortable?(r(),F(xe,{key:0,"aria-hidden":"true",class:"caret",color:`var(--kui-color-text, ${X(Ge)})`,icon:"chevronDown",size:X(Ve)},null,8,["color","size"])):R("",!0)])],10,nt))),128))],2)],2),M("tbody",null,[(r(!0),b(W,null,J(g.value,(a,o)=>(r(),b("tr",fe(t.rowAttrs(a),{key:`k-table-${B.value}-row-${o}`,role:w.value?"link":null,tabindex:w.value?0:null},ve(t.hasSideBorder?ee.value(a,a):{},!0)),[(r(!0),b(W,null,J(j.value,(f,i)=>(r(),b("td",fe(t.cellAttrs({headerKey:f.key,row:a,rowIndex:o,colIndex:i}),{key:`k-table-${B.value}-cell-${i}`},ve(ee.value(a[f.key],a),!0)),[H(e.$slots,f.key,{row:Y(a),rowKey:o,rowValue:a[f.key]},()=>[A(C(a[f.key]),1)],!0)],16))),128))],16,it))),128))])],10,ot),we.value?(r(),F(Ue,{key:0,class:"k-table-pagination","current-page":u.value,"data-testid":"k-table-pagination","disable-page-jump":t.disablePaginationPageJump,"initial-page-size":P.value,neighbors:t.paginationNeighbors,"offset-next-button-disabled":!h.value,"offset-prev-button-disabled":!U.value,"page-sizes":t.paginationPageSizes,"pagination-type":t.paginationType,"test-mode":!!t.testMode||void 0,"total-count":q.value,onGetNextOffset:je,onGetPrevOffset:qe,onPageChanged:Le,onPageSizeChanged:He},null,8,["current-page","disable-page-jump","initial-page-size","neighbors","offset-next-button-disabled","offset-prev-button-disabled","page-sizes","pagination-type","test-mode","total-count"])):R("",!0)],32))]))}}),dt=De(ct,[["__scopeId","data-v-73eabf11"]]),ht=pe({__name:"SandboxTable",setup(t){const p=async()=>{await new Promise(G=>setTimeout(G,2e3));const m=await(await fetch("https://jsonplaceholder.typicode.com/users")).json();return{data:m,total:m.length}};return(l,m)=>(r(),F(X(dt),{fetcher:p,headers:[{key:"name",label:"Name"},{key:"username",label:"Username"},{key:"email",label:"Email"}],"initial-fetcher-params":{pageSize:30}}))}});export{ht as default};
