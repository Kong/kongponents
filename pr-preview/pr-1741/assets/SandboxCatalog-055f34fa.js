import"./KMethodBadge.vue_vue_type_style_index_0_scoped_7163314d_lang-f7cf77a3.js";import{c as D}from"./KButton-a4a69627.js";import{u as le}from"./useUtilities-efbdde2e.js";import{K as P,_ as de,a as ue,b as G}from"./KPagination-4191a1f8.js";import{K as ge}from"./KCard-fe39ffac.js";import{d as F,o as r,A,w as o,v as d,f as l,t as s,s as N,p as J,_ as W,k as me,c as b,l as c,i as I,m as ye,a as S,q as z,e as h,F as fe,b as Se,u as ve}from"./index-d7edae6d.js";import{v as he}from"./KInput-62a47042.js";const ke=["large","medium","small"],pe=F({__name:"KCatalogItem",props:{item:{type:Object,default:()=>({})},truncate:{type:Boolean,default:!0},testMode:{type:Boolean,default:!1}},emits:["card:click"],setup(e,{emit:y}){const n=(u,g)=>{y("card:click",{evt:u,item:g})};return(u,g)=>(r(),A(ge,{class:"k-card-catalog-item","data-testid":e.item&&e.item.title?`${e.item.title.replace(/[^0-9a-z]/gi,"-")}-catalog-item`:"catalog-item","has-hover":"",role:"button",tabindex:"0","test-mode":!!e.testMode||void 0,onClick:g[0]||(g[0]=f=>n(f,e.item))},{title:o(()=>[d(u.$slots,"cardTitle",{},()=>[l(s(e.item?e.item.title:""),1)],!0)]),actions:o(()=>[d(u.$slots,"cardActions",{},void 0,!0)]),body:o(()=>[N("div",{class:J({"multi-line-truncate":e.truncate})},[d(u.$slots,"cardBody",{},()=>[l(s(e.item?e.item.description:""),1)],!0)],2)]),_:3},8,["data-testid","test-mode"]))}}),be=W(pe,[["__scopeId","data-v-6e04fbca"]]),Ie={class:"k-card-catalog"},Ae={key:0,class:"k-card-catalog-title","data-testid":"k-catalog-title"},Ce={key:1,class:"k-catalog-toolbar","data-testid":"k-catalog-toolbar"},ze={class:"k-catalog-skeleton-footer-container"},$e={key:3,class:"k-catalog-error-state","data-testid":"k-card-catalog-error-state"},Me={key:4,class:"k-catalog-empty-state","data-testid":"k-card-catalog-empty-state"},Pe=["data-tableid"],Be={key:0,class:"card-pagination","data-testid":"k-catalog-pagination"},Te=F({__name:"KCatalog",props:{isLoading:{type:Boolean,default:!1},cardSize:{type:String,default:"medium",validator:e=>ke.includes(e)},title:{type:String,default:""},noTruncation:{type:Boolean,default:!1},emptyStateTitle:{type:String,default:"No Data"},emptyStateMessage:{type:String,default:"There is no data to display."},emptyStateActionRoute:{type:[Object,String],default:""},emptyStateActionMessage:{type:String,default:""},emptyStateActionButtonIcon:{type:String,default:""},emptyStateIcon:{type:String,default:""},emptyStateIconColor:{type:String,default:""},emptyStateIconSize:{type:String,default:"50"},hasError:{type:Boolean,default:!1},errorStateTitle:{type:String,default:"An error occurred"},errorStateMessage:{type:String,default:"Data cannot be displayed due to an error."},errorStateActionRoute:{type:[Object,String],default:""},errorStateActionMessage:{type:String,default:""},errorStateIcon:{type:String,default:""},errorStateIconColor:{type:String,default:""},errorStateIconSize:{type:String,default:"50"},fetcher:{type:Function,required:!0},initialFetcherParams:{type:Object,default:null},cacheIdentifier:{type:String,default:""},fetcherCacheKey:{type:String,default:""},searchInput:{type:String,default:""},paginationNeighbors:{type:Number,default:1},paginationPageSizes:{type:Array,default:()=>[15,30,50,75,100],validator:e=>!!e.length&&e.every(y=>typeof y=="number")},paginationTotalItems:{type:Number,default:null},disablePaginationPageJump:{type:Boolean,default:!1},disablePagination:{type:Boolean,default:!1},hidePaginationWhenOptional:{type:Boolean,default:!1},testMode:{type:[String,Boolean],default:!1}},emits:["card:click","kcatalog-error-cta-clicked","kcatalog-empty-state-cta-clicked","update:catalog-preferences","state"],setup(e,{emit:y}){const n=e,{useRequest:u,useDebounce:g,useSwrvState:f}=le(),U=me(),R=b(()=>n.testMode?"test-catalog-id-1234":he()),$={page:1,pageSize:15,query:""},v=c([]),B=c(0),j=c(""),m=c(1),k=c(15),T=c(!1),X=b(()=>!!U.toolbar),Y=b(()=>({pageSize:k.value})),q=c(!0),Z=async()=>{var a;const t=n.searchInput,i=await n.fetcher({query:t||j.value,pageSize:k.value,page:m.value});return v.value=i.data,B.value=n.paginationTotalItems||i.total||((a=i.data)==null?void 0:a.length),q.value=!1,i},x=()=>{const t={...$,...n.initialFetcherParams};m.value=t.page??$.page,k.value=t.pageSize??$.pageSize,j.value=t.query??$.query,T.value=!0},_=b(()=>{if(!n.fetcher||!T.value)return"";let t=R.value;return n.cacheIdentifier&&(t=n.cacheIdentifier),n.fetcherCacheKey&&(t+=`-${n.fetcherCacheKey}`),`k-catalog_${t}`}),E=c(""),{debouncedFn:ee,generateDebouncedFn:te}=g(t=>{E.value=t},350),ae=te(0),{data:w,error:L,revalidate:oe,isValidating:ie}=u(()=>_.value,()=>Z(),{revalidateOnFocus:!1,revalidateDebounce:0}),{state:K,hasData:ne,swrvState:O}=f(w,L,ie),p=c(!0),V=b(()=>({hasData:ne.value,state:K.value})),re=b(()=>p.value?"loading":L.value?"error":"success"),se=({page:t})=>{m.value=t},ce=({pageSize:t})=>{k.value=t,m.value=1},H=t=>t.toLowerCase().replace(/[^[a-z0-9]/gi,"-");I(w,t=>{t!=null&&t.length&&!v.value.length&&(v.value=t)},{deep:!0,immediate:!0}),I(K,()=>{switch(K.value){case O.PENDING:p.value=!0;break;case O.VALIDATING_HAS_DATA:p.value=C.value;break;default:p.value=!1;break}},{immediate:!0}),I([V,re],t=>{var i;y("state",{state:t==null?void 0:t[1],hasData:(i=t==null?void 0:t[0])==null?void 0:i.hasData})}),I(()=>n.searchInput,t=>{m.value!==1&&(m.value=1),t===""?ae(t):ee(t)},{immediate:!0});const C=c(!1);return I([E,m,k],async(t,i)=>{const a=i==null?void 0:i[0],M=t[0],Q=t[1];M!==a&&Q!==1&&(m.value=1),T.value&&!q.value&&(C.value=!0,await oe(),C.value=!1)},{deep:!0,immediate:!0}),I(Y,t=>{y("update:catalog-preferences",t)}),ye(()=>{x()}),(t,i)=>(r(),S("div",Ie,[e.title?(r(),S("div",Ae,[N("h3",null,s(e.title),1)])):z("",!0),X.value?(r(),S("div",Ce,[d(t.$slots,"toolbar",{state:V.value},void 0,!0)])):z("",!0),(!e.testMode||e.testMode==="loading")&&(p.value||e.isLoading||C.value)&&!e.hasError?(r(),A(de,{key:2,"card-count":4,class:"k-skeleton-grid","data-testid":"k-catalog-skeleton",type:"card"},{"card-header":o(()=>[h(P,{class:"k-catalog-skeleton-header",width:"6"})]),"card-content":o(()=>[h(P,{width:"75"})]),"card-footer":o(()=>[N("div",ze,[h(P,{width:"2"}),h(P,{width:"5"})])]),_:1})):e.hasError?(r(),S("div",$e,[d(t.$slots,"error-state",{},()=>[h(G,{"cta-is-hidden":!e.errorStateActionMessage||!e.errorStateActionRoute,icon:e.errorStateIcon||"","icon-color":e.errorStateIconColor,"icon-size":e.errorStateIconSize,"is-error":""},{title:o(()=>[l(s(e.errorStateTitle),1)]),message:o(()=>[l(s(e.errorStateMessage),1)]),cta:o(()=>[e.errorStateActionMessage?(r(),A(D,{key:0,appearance:"primary","data-testid":H(e.errorStateActionMessage),to:e.errorStateActionRoute?e.errorStateActionRoute:void 0,onClick:i[0]||(i[0]=a=>t.$emit("kcatalog-error-cta-clicked"))},{default:o(()=>[l(s(e.errorStateActionMessage),1)]),_:1},8,["data-testid","to"])):z("",!0)]),_:1},8,["cta-is-hidden","icon","icon-color","icon-size"])],!0)])):!e.hasError&&!p.value&&!e.isLoading&&!C.value&&v.value&&!v.value.length?(r(),S("div",Me,[d(t.$slots,"empty-state",{},()=>[h(G,{"cta-is-hidden":!e.emptyStateActionMessage||!e.emptyStateActionRoute,icon:e.emptyStateIcon||"","icon-color":e.emptyStateIconColor,"icon-size":e.emptyStateIconSize},{title:o(()=>[l(s(e.emptyStateTitle),1)]),message:o(()=>[l(s(e.emptyStateMessage),1)]),cta:o(()=>[e.emptyStateActionMessage?(r(),A(D,{key:0,appearance:e.searchInput?"btn-link":"primary","data-testid":H(e.emptyStateActionMessage),icon:e.emptyStateActionButtonIcon,to:e.emptyStateActionRoute?e.emptyStateActionRoute:void 0,onClick:i[1]||(i[1]=a=>t.$emit("kcatalog-empty-state-cta-clicked"))},{default:o(()=>[l(s(e.emptyStateActionMessage),1)]),_:1},8,["appearance","data-testid","icon","to"])):z("",!0)]),_:1},8,["cta-is-hidden","icon","icon-color","icon-size"])],!0)])):(r(),S("div",{key:5,class:J(["k-catalog-page",`k-card-${e.cardSize}`]),"data-tableid":R.value},[d(t.$slots,"body",{data:v.value},()=>[(r(!0),S(fe,null,Se(v.value,(a,M)=>(r(),A(be,{key:a.key?a.key:`k-catalog-item-${M}`,class:"catalog-item","data-testid":a.id?a.id:`k-catalog-item-${M}`,item:a,"test-mode":!!e.testMode||void 0,truncate:!e.noTruncation,onClick:Q=>t.$emit("card:click",a)},{cardTitle:o(()=>[d(t.$slots,"cardTitle",{item:a},()=>[l(s(a.title),1)],!0)]),cardActions:o(()=>[d(t.$slots,"cardActions",{item:a},void 0,!0)]),cardBody:o(()=>[d(t.$slots,"cardBody",{item:a},()=>[l(s(a.description),1)],!0)]),_:2},1032,["data-testid","item","test-mode","truncate","onClick"]))),128))],!0),!e.disablePagination&&e.fetcher&&!(e.hidePaginationWhenOptional&&B.value<=e.paginationPageSizes[0])?(r(),S("div",Be,[h(ue,{class:"k-catalog-pagination","current-page":m.value,"disable-page-jump":e.disablePaginationPageJump,"initial-page-size":k.value,neighbors:e.paginationNeighbors,"page-sizes":e.paginationPageSizes,"test-mode":!!e.testMode||void 0,"total-count":B.value,onPageChanged:se,onPageSizeChanged:ce},null,8,["current-page","disable-page-jump","initial-page-size","neighbors","page-sizes","test-mode","total-count"])])):z("",!0)],10,Pe))]))}}),Ke=W(Te,[["__scopeId","data-v-ce6a2019"]]),Le=F({__name:"SandboxCatalog",setup(e){const y=async()=>{await new Promise(f=>setTimeout(f,2e3));const g=(await(await fetch("https://jsonplaceholder.typicode.com/users")).json()).map(f=>({title:f.name,description:f.email}));return{data:g,total:g.length}};return(n,u)=>(r(),A(ve(Ke),{fetcher:y}))}});export{Le as default};
